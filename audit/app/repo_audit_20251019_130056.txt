
===== Aperçu =====
- Date: 19/10/2025 13:00:58
- Racine: C:\ATLAS\INBOX\dev\devops\platform_lite\doctrine-demo-platform-lite
- Sortie: C:\ATLAS\INBOX\dev\devops\platform_lite\doctrine-demo-platform-lite\audit\app\repo_audit_20251019_130056.txt

===== Git =====
- Branch: demo/audit-20251018-0214
- HEAD: 0955e7f
Remotes:
(none)
Status:
?? audit/app/
Last commit: 0955e7f 2025-10-18 22:04:08 +0200 flobehejohn docs: README recruteur (usage, schéma, vérifs, traçabilité)

===== Tree (complet) =====
.circleci
.vscode
app
audit
docs
k8s
monitoring
scripts
terraform
.dockerignore
.env.example
.gitattributes
.gitignore
CHECKLIST.md
demo.gif
Dockerfile
Makefile
METRICS.md
p95.json
README.md
ROUTES.md
RUNBOOK.md
SLO.md
targets.json
.circleci\config.yml
.vscode\README_copilot.txt
.vscode\tasks.json
app\node_modules
app\public
app\Dockerfile
app\index.js
app\package-lock.json
app\package.json
app\node_modules\.bin
app\node_modules\accepts
app\node_modules\array-flatten
app\node_modules\bintrees
app\node_modules\body-parser
app\node_modules\bytes
app\node_modules\call-bind-apply-helpers
app\node_modules\call-bound
app\node_modules\content-disposition
app\node_modules\content-type
app\node_modules\cookie
app\node_modules\cookie-signature
app\node_modules\debug
app\node_modules\depd
app\node_modules\destroy
app\node_modules\dunder-proto
app\node_modules\ee-first
app\node_modules\encodeurl
app\node_modules\es-define-property
app\node_modules\es-errors
app\node_modules\es-object-atoms
app\node_modules\escape-html
app\node_modules\etag
app\node_modules\express
app\node_modules\finalhandler
app\node_modules\forwarded
app\node_modules\fresh
app\node_modules\function-bind
app\node_modules\get-intrinsic
app\node_modules\get-proto
app\node_modules\gopd
app\node_modules\has-symbols
app\node_modules\hasown
app\node_modules\http-errors
app\node_modules\iconv-lite
app\node_modules\inherits
app\node_modules\ipaddr.js
app\node_modules\math-intrinsics
app\node_modules\media-typer
app\node_modules\merge-descriptors
app\node_modules\methods
app\node_modules\mime
app\node_modules\mime-db
app\node_modules\mime-types
app\node_modules\ms
app\node_modules\negotiator
app\node_modules\object-inspect
app\node_modules\on-finished
app\node_modules\parseurl
app\node_modules\path-to-regexp
app\node_modules\prom-client
app\node_modules\proxy-addr
app\node_modules\qs
app\node_modules\range-parser
app\node_modules\raw-body
app\node_modules\safe-buffer
app\node_modules\safer-buffer
app\node_modules\send
app\node_modules\serve-static
app\node_modules\setprototypeof
app\node_modules\side-channel
app\node_modules\side-channel-list
app\node_modules\side-channel-map
app\node_modules\side-channel-weakmap
app\node_modules\statuses
app\node_modules\tdigest
app\node_modules\toidentifier
app\node_modules\type-is
app\node_modules\unpipe
app\node_modules\utils-merge
app\node_modules\vary
app\node_modules\.package-lock.json
app\node_modules\.bin\mime
app\node_modules\.bin\mime.cmd
app\node_modules\.bin\mime.ps1
app\node_modules\accepts\HISTORY.md
app\node_modules\accepts\index.js
app\node_modules\accepts\LICENSE
app\node_modules\accepts\package.json
app\node_modules\accepts\README.md
app\node_modules\array-flatten\array-flatten.js
app\node_modules\array-flatten\LICENSE
app\node_modules\array-flatten\package.json
app\node_modules\array-flatten\README.md
app\node_modules\bintrees\dist
app\node_modules\bintrees\examples
app\node_modules\bintrees\lib
app\node_modules\bintrees\test
app\node_modules\bintrees\.npmignore
app\node_modules\bintrees\.travis.yml
app\node_modules\bintrees\index.js
app\node_modules\bintrees\LICENSE
app\node_modules\bintrees\Makefile
app\node_modules\bintrees\package.json
app\node_modules\bintrees\README.md
app\node_modules\bintrees\dist\bintree.js
app\node_modules\bintrees\dist\bintree.min.js
app\node_modules\bintrees\dist\rbtree.js
app\node_modules\bintrees\dist\rbtree.min.js
app\node_modules\bintrees\examples\client.html
app\node_modules\bintrees\examples\node.js
app\node_modules\bintrees\lib\bintree.js
app\node_modules\bintrees\lib\rbtree.js
app\node_modules\bintrees\lib\treebase.js
app\node_modules\bintrees\test\perf
app\node_modules\bintrees\test\samples
app\node_modules\bintrees\test\scripts
app\node_modules\bintrees\test\arrtree.js
app\node_modules\bintrees\test\loader.js
app\node_modules\bintrees\test\perf_test.js
app\node_modules\bintrees\test\test_api.js
app\node_modules\bintrees\test\test_correctness.js
app\node_modules\bintrees\test\perf\100k
app\node_modules\bintrees\test\samples\10k
app\node_modules\bintrees\test\scripts\gen_test.js
app\node_modules\body-parser\lib
app\node_modules\body-parser\HISTORY.md
app\node_modules\body-parser\index.js
app\node_modules\body-parser\LICENSE
app\node_modules\body-parser\package.json
app\node_modules\body-parser\README.md
app\node_modules\body-parser\SECURITY.md
app\node_modules\body-parser\lib\types
app\node_modules\body-parser\lib\read.js
app\node_modules\body-parser\lib\types\json.js
app\node_modules\body-parser\lib\types\raw.js
app\node_modules\body-parser\lib\types\text.js
app\node_modules\body-parser\lib\types\urlencoded.js
app\node_modules\bytes\History.md
app\node_modules\bytes\index.js
app\node_modules\bytes\LICENSE
app\node_modules\bytes\package.json
app\node_modules\bytes\Readme.md
app\node_modules\call-bind-apply-helpers\.github
app\node_modules\call-bind-apply-helpers\test
app\node_modules\call-bind-apply-helpers\.eslintrc
app\node_modules\call-bind-apply-helpers\.nycrc
app\node_modules\call-bind-apply-helpers\actualApply.d.ts
app\node_modules\call-bind-apply-helpers\actualApply.js
app\node_modules\call-bind-apply-helpers\applyBind.d.ts
app\node_modules\call-bind-apply-helpers\applyBind.js
app\node_modules\call-bind-apply-helpers\CHANGELOG.md
app\node_modules\call-bind-apply-helpers\functionApply.d.ts
app\node_modules\call-bind-apply-helpers\functionApply.js
app\node_modules\call-bind-apply-helpers\functionCall.d.ts
app\node_modules\call-bind-apply-helpers\functionCall.js
app\node_modules\call-bind-apply-helpers\index.d.ts
app\node_modules\call-bind-apply-helpers\index.js
app\node_modules\call-bind-apply-helpers\LICENSE
app\node_modules\call-bind-apply-helpers\package.json
app\node_modules\call-bind-apply-helpers\README.md
app\node_modules\call-bind-apply-helpers\reflectApply.d.ts
app\node_modules\call-bind-apply-helpers\reflectApply.js
app\node_modules\call-bind-apply-helpers\tsconfig.json
app\node_modules\call-bind-apply-helpers\.github\FUNDING.yml
app\node_modules\call-bind-apply-helpers\test\index.js
app\node_modules\call-bound\.github
app\node_modules\call-bound\test
app\node_modules\call-bound\.eslintrc
app\node_modules\call-bound\.nycrc
app\node_modules\call-bound\CHANGELOG.md
app\node_modules\call-bound\index.d.ts
app\node_modules\call-bound\index.js
app\node_modules\call-bound\LICENSE
app\node_modules\call-bound\package.json
app\node_modules\call-bound\README.md
app\node_modules\call-bound\tsconfig.json
app\node_modules\call-bound\.github\FUNDING.yml
app\node_modules\call-bound\test\index.js
app\node_modules\content-disposition\HISTORY.md
app\node_modules\content-disposition\index.js
app\node_modules\content-disposition\LICENSE
app\node_modules\content-disposition\package.json
app\node_modules\content-disposition\README.md
app\node_modules\content-type\HISTORY.md
app\node_modules\content-type\index.js
app\node_modules\content-type\LICENSE
app\node_modules\content-type\package.json
app\node_modules\content-type\README.md
app\node_modules\cookie\index.js
app\node_modules\cookie\LICENSE
app\node_modules\cookie\package.json
app\node_modules\cookie\README.md
app\node_modules\cookie\SECURITY.md
app\node_modules\cookie-signature\.npmignore
app\node_modules\cookie-signature\History.md
app\node_modules\cookie-signature\index.js
app\node_modules\cookie-signature\package.json
app\node_modules\cookie-signature\Readme.md
app\node_modules\debug\src
app\node_modules\debug\.coveralls.yml
app\node_modules\debug\.eslintrc
app\node_modules\debug\.npmignore
app\node_modules\debug\.travis.yml
app\node_modules\debug\CHANGELOG.md
app\node_modules\debug\component.json
app\node_modules\debug\karma.conf.js
app\node_modules\debug\LICENSE
app\node_modules\debug\Makefile
app\node_modules\debug\node.js
app\node_modules\debug\package.json
app\node_modules\debug\README.md
app\node_modules\debug\src\browser.js
app\node_modules\debug\src\debug.js
app\node_modules\debug\src\index.js
app\node_modules\debug\src\inspector-log.js
app\node_modules\debug\src\node.js
app\node_modules\depd\lib
app\node_modules\depd\History.md
app\node_modules\depd\index.js
app\node_modules\depd\LICENSE
app\node_modules\depd\package.json
app\node_modules\depd\Readme.md
app\node_modules\depd\lib\browser
app\node_modules\depd\lib\browser\index.js
app\node_modules\destroy\index.js
app\node_modules\destroy\LICENSE
app\node_modules\destroy\package.json
app\node_modules\destroy\README.md
app\node_modules\dunder-proto\.github
app\node_modules\dunder-proto\test
app\node_modules\dunder-proto\.eslintrc
app\node_modules\dunder-proto\.nycrc
app\node_modules\dunder-proto\CHANGELOG.md
app\node_modules\dunder-proto\get.d.ts
app\node_modules\dunder-proto\get.js
app\node_modules\dunder-proto\LICENSE
app\node_modules\dunder-proto\package.json
app\node_modules\dunder-proto\README.md
app\node_modules\dunder-proto\set.d.ts
app\node_modules\dunder-proto\set.js
app\node_modules\dunder-proto\tsconfig.json
app\node_modules\dunder-proto\.github\FUNDING.yml
app\node_modules\dunder-proto\test\get.js
app\node_modules\dunder-proto\test\index.js
app\node_modules\dunder-proto\test\set.js
app\node_modules\ee-first\index.js
app\node_modules\ee-first\LICENSE
app\node_modules\ee-first\package.json
app\node_modules\ee-first\README.md
app\node_modules\encodeurl\index.js
app\node_modules\encodeurl\LICENSE
app\node_modules\encodeurl\package.json
app\node_modules\encodeurl\README.md
app\node_modules\es-define-property\.github
app\node_modules\es-define-property\test
app\node_modules\es-define-property\.eslintrc
app\node_modules\es-define-property\.nycrc
app\node_modules\es-define-property\CHANGELOG.md
app\node_modules\es-define-property\index.d.ts
app\node_modules\es-define-property\index.js
app\node_modules\es-define-property\LICENSE
app\node_modules\es-define-property\package.json
app\node_modules\es-define-property\README.md
app\node_modules\es-define-property\tsconfig.json
app\node_modules\es-define-property\.github\FUNDING.yml
app\node_modules\es-define-property\test\index.js
app\node_modules\es-errors\.github
app\node_modules\es-errors\test
app\node_modules\es-errors\.eslintrc
app\node_modules\es-errors\CHANGELOG.md
app\node_modules\es-errors\eval.d.ts
app\node_modules\es-errors\eval.js
app\node_modules\es-errors\index.d.ts
app\node_modules\es-errors\index.js
app\node_modules\es-errors\LICENSE
app\node_modules\es-errors\package.json
app\node_modules\es-errors\range.d.ts
app\node_modules\es-errors\range.js
app\node_modules\es-errors\README.md
app\node_modules\es-errors\ref.d.ts
app\node_modules\es-errors\ref.js
app\node_modules\es-errors\syntax.d.ts
app\node_modules\es-errors\syntax.js
app\node_modules\es-errors\tsconfig.json
app\node_modules\es-errors\type.d.ts
app\node_modules\es-errors\type.js
app\node_modules\es-errors\uri.d.ts
app\node_modules\es-errors\uri.js
app\node_modules\es-errors\.github\FUNDING.yml
app\node_modules\es-errors\test\index.js
app\node_modules\es-object-atoms\.github
app\node_modules\es-object-atoms\test
app\node_modules\es-object-atoms\.eslintrc
app\node_modules\es-object-atoms\CHANGELOG.md
app\node_modules\es-object-atoms\index.d.ts
app\node_modules\es-object-atoms\index.js
app\node_modules\es-object-atoms\isObject.d.ts
app\node_modules\es-object-atoms\isObject.js
app\node_modules\es-object-atoms\LICENSE
app\node_modules\es-object-atoms\package.json
app\node_modules\es-object-atoms\README.md
app\node_modules\es-object-atoms\RequireObjectCoercible.d.ts
app\node_modules\es-object-atoms\RequireObjectCoercible.js
app\node_modules\es-object-atoms\ToObject.d.ts
app\node_modules\es-object-atoms\ToObject.js
app\node_modules\es-object-atoms\tsconfig.json
app\node_modules\es-object-atoms\.github\FUNDING.yml
app\node_modules\es-object-atoms\test\index.js
app\node_modules\escape-html\index.js
app\node_modules\escape-html\LICENSE
app\node_modules\escape-html\package.json
app\node_modules\escape-html\Readme.md
app\node_modules\etag\HISTORY.md
app\node_modules\etag\index.js
app\node_modules\etag\LICENSE
app\node_modules\etag\package.json
app\node_modules\etag\README.md
app\node_modules\express\lib
app\node_modules\express\History.md
app\node_modules\express\index.js
app\node_modules\express\LICENSE
app\node_modules\express\package.json
app\node_modules\express\Readme.md
app\node_modules\express\lib\middleware
app\node_modules\express\lib\router
app\node_modules\express\lib\application.js
app\node_modules\express\lib\express.js
app\node_modules\express\lib\request.js
app\node_modules\express\lib\response.js
app\node_modules\express\lib\utils.js
app\node_modules\express\lib\view.js
app\node_modules\express\lib\middleware\init.js
app\node_modules\express\lib\middleware\query.js
app\node_modules\express\lib\router\index.js
app\node_modules\express\lib\router\layer.js
app\node_modules\express\lib\router\route.js
app\node_modules\finalhandler\HISTORY.md
app\node_modules\finalhandler\index.js
app\node_modules\finalhandler\LICENSE
app\node_modules\finalhandler\package.json
app\node_modules\finalhandler\README.md
app\node_modules\finalhandler\SECURITY.md
app\node_modules\forwarded\HISTORY.md
app\node_modules\forwarded\index.js
app\node_modules\forwarded\LICENSE
app\node_modules\forwarded\package.json
app\node_modules\forwarded\README.md
app\node_modules\fresh\HISTORY.md
app\node_modules\fresh\index.js
app\node_modules\fresh\LICENSE
app\node_modules\fresh\package.json
app\node_modules\fresh\README.md
app\node_modules\function-bind\.github
app\node_modules\function-bind\test
app\node_modules\function-bind\.eslintrc
app\node_modules\function-bind\.nycrc
app\node_modules\function-bind\CHANGELOG.md
app\node_modules\function-bind\implementation.js
app\node_modules\function-bind\index.js
app\node_modules\function-bind\LICENSE
app\node_modules\function-bind\package.json
app\node_modules\function-bind\README.md
app\node_modules\function-bind\.github\FUNDING.yml
app\node_modules\function-bind\.github\SECURITY.md
app\node_modules\function-bind\test\.eslintrc
app\node_modules\function-bind\test\index.js
app\node_modules\get-intrinsic\.github
app\node_modules\get-intrinsic\test
app\node_modules\get-intrinsic\.eslintrc
app\node_modules\get-intrinsic\.nycrc
app\node_modules\get-intrinsic\CHANGELOG.md
app\node_modules\get-intrinsic\index.js
app\node_modules\get-intrinsic\LICENSE
app\node_modules\get-intrinsic\package.json
app\node_modules\get-intrinsic\README.md
app\node_modules\get-intrinsic\.github\FUNDING.yml
app\node_modules\get-intrinsic\test\GetIntrinsic.js
app\node_modules\get-proto\.github
app\node_modules\get-proto\test
app\node_modules\get-proto\.eslintrc
app\node_modules\get-proto\.nycrc
app\node_modules\get-proto\CHANGELOG.md
app\node_modules\get-proto\index.d.ts
app\node_modules\get-proto\index.js
app\node_modules\get-proto\LICENSE
app\node_modules\get-proto\Object.getPrototypeOf.d.ts
app\node_modules\get-proto\Object.getPrototypeOf.js
app\node_modules\get-proto\package.json
app\node_modules\get-proto\README.md
app\node_modules\get-proto\Reflect.getPrototypeOf.d.ts
app\node_modules\get-proto\Reflect.getPrototypeOf.js
app\node_modules\get-proto\tsconfig.json
app\node_modules\get-proto\.github\FUNDING.yml
app\node_modules\get-proto\test\index.js
app\node_modules\gopd\.github
app\node_modules\gopd\test
app\node_modules\gopd\.eslintrc
app\node_modules\gopd\CHANGELOG.md
app\node_modules\gopd\gOPD.d.ts
app\node_modules\gopd\gOPD.js
app\node_modules\gopd\index.d.ts
app\node_modules\gopd\index.js
app\node_modules\gopd\LICENSE
app\node_modules\gopd\package.json
app\node_modules\gopd\README.md
app\node_modules\gopd\tsconfig.json
app\node_modules\gopd\.github\FUNDING.yml
app\node_modules\gopd\test\index.js
app\node_modules\has-symbols\.github
app\node_modules\has-symbols\test
app\node_modules\has-symbols\.eslintrc
app\node_modules\has-symbols\.nycrc
app\node_modules\has-symbols\CHANGELOG.md
app\node_modules\has-symbols\index.d.ts
app\node_modules\has-symbols\index.js
app\node_modules\has-symbols\LICENSE
app\node_modules\has-symbols\package.json
app\node_modules\has-symbols\README.md
app\node_modules\has-symbols\shams.d.ts
app\node_modules\has-symbols\shams.js
app\node_modules\has-symbols\tsconfig.json
app\node_modules\has-symbols\.github\FUNDING.yml
app\node_modules\has-symbols\test\shams
app\node_modules\has-symbols\test\index.js
app\node_modules\has-symbols\test\tests.js
app\node_modules\has-symbols\test\shams\core-js.js
app\node_modules\has-symbols\test\shams\get-own-property-symbols.js
app\node_modules\hasown\.github
app\node_modules\hasown\.eslintrc
app\node_modules\hasown\.nycrc
app\node_modules\hasown\CHANGELOG.md
app\node_modules\hasown\index.d.ts
app\node_modules\hasown\index.js
app\node_modules\hasown\LICENSE
app\node_modules\hasown\package.json
app\node_modules\hasown\README.md
app\node_modules\hasown\tsconfig.json
app\node_modules\hasown\.github\FUNDING.yml
app\node_modules\http-errors\HISTORY.md
app\node_modules\http-errors\index.js
app\node_modules\http-errors\LICENSE
app\node_modules\http-errors\package.json
app\node_modules\http-errors\README.md
app\node_modules\iconv-lite\encodings
app\node_modules\iconv-lite\lib
app\node_modules\iconv-lite\Changelog.md
app\node_modules\iconv-lite\LICENSE
app\node_modules\iconv-lite\package.json
app\node_modules\iconv-lite\README.md
app\node_modules\iconv-lite\encodings\tables
app\node_modules\iconv-lite\encodings\dbcs-codec.js
app\node_modules\iconv-lite\encodings\dbcs-data.js
app\node_modules\iconv-lite\encodings\index.js
app\node_modules\iconv-lite\encodings\internal.js
app\node_modules\iconv-lite\encodings\sbcs-codec.js
app\node_modules\iconv-lite\encodings\sbcs-data-generated.js
app\node_modules\iconv-lite\encodings\sbcs-data.js
app\node_modules\iconv-lite\encodings\utf16.js
app\node_modules\iconv-lite\encodings\utf7.js
app\node_modules\iconv-lite\encodings\tables\big5-added.json
app\node_modules\iconv-lite\encodings\tables\cp936.json
app\node_modules\iconv-lite\encodings\tables\cp949.json
app\node_modules\iconv-lite\encodings\tables\cp950.json
app\node_modules\iconv-lite\encodings\tables\eucjp.json
app\node_modules\iconv-lite\encodings\tables\gb18030-ranges.json
app\node_modules\iconv-lite\encodings\tables\gbk-added.json
app\node_modules\iconv-lite\encodings\tables\shiftjis.json
app\node_modules\iconv-lite\lib\bom-handling.js
app\node_modules\iconv-lite\lib\extend-node.js
app\node_modules\iconv-lite\lib\index.d.ts
app\node_modules\iconv-lite\lib\index.js
app\node_modules\iconv-lite\lib\streams.js
app\node_modules\inherits\inherits_browser.js
app\node_modules\inherits\inherits.js
app\node_modules\inherits\LICENSE
app\node_modules\inherits\package.json
app\node_modules\inherits\README.md
app\node_modules\ipaddr.js\lib
app\node_modules\ipaddr.js\ipaddr.min.js
app\node_modules\ipaddr.js\LICENSE
app\node_modules\ipaddr.js\package.json
app\node_modules\ipaddr.js\README.md
app\node_modules\ipaddr.js\lib\ipaddr.js
app\node_modules\ipaddr.js\lib\ipaddr.js.d.ts
app\node_modules\math-intrinsics\.github
app\node_modules\math-intrinsics\constants
app\node_modules\math-intrinsics\test
app\node_modules\math-intrinsics\.eslintrc
app\node_modules\math-intrinsics\abs.d.ts
app\node_modules\math-intrinsics\abs.js
app\node_modules\math-intrinsics\CHANGELOG.md
app\node_modules\math-intrinsics\floor.d.ts
app\node_modules\math-intrinsics\floor.js
app\node_modules\math-intrinsics\isFinite.d.ts
app\node_modules\math-intrinsics\isFinite.js
app\node_modules\math-intrinsics\isInteger.d.ts
app\node_modules\math-intrinsics\isInteger.js
app\node_modules\math-intrinsics\isNaN.d.ts
app\node_modules\math-intrinsics\isNaN.js
app\node_modules\math-intrinsics\isNegativeZero.d.ts
app\node_modules\math-intrinsics\isNegativeZero.js
app\node_modules\math-intrinsics\LICENSE
app\node_modules\math-intrinsics\max.d.ts
app\node_modules\math-intrinsics\max.js
app\node_modules\math-intrinsics\min.d.ts
app\node_modules\math-intrinsics\min.js
app\node_modules\math-intrinsics\mod.d.ts
app\node_modules\math-intrinsics\mod.js
app\node_modules\math-intrinsics\package.json
app\node_modules\math-intrinsics\pow.d.ts
app\node_modules\math-intrinsics\pow.js
app\node_modules\math-intrinsics\README.md
app\node_modules\math-intrinsics\round.d.ts
app\node_modules\math-intrinsics\round.js
app\node_modules\math-intrinsics\sign.d.ts
app\node_modules\math-intrinsics\sign.js
app\node_modules\math-intrinsics\tsconfig.json
app\node_modules\math-intrinsics\.github\FUNDING.yml
app\node_modules\math-intrinsics\constants\maxArrayLength.d.ts
app\node_modules\math-intrinsics\constants\maxArrayLength.js
app\node_modules\math-intrinsics\constants\maxSafeInteger.d.ts
app\node_modules\math-intrinsics\constants\maxSafeInteger.js
app\node_modules\math-intrinsics\constants\maxValue.d.ts
app\node_modules\math-intrinsics\constants\maxValue.js
app\node_modules\math-intrinsics\test\index.js
app\node_modules\media-typer\HISTORY.md
app\node_modules\media-typer\index.js
app\node_modules\media-typer\LICENSE
app\node_modules\media-typer\package.json
app\node_modules\media-typer\README.md
app\node_modules\merge-descriptors\HISTORY.md
app\node_modules\merge-descriptors\index.js
app\node_modules\merge-descriptors\LICENSE
app\node_modules\merge-descriptors\package.json
app\node_modules\merge-descriptors\README.md
app\node_modules\methods\HISTORY.md
app\node_modules\methods\index.js
app\node_modules\methods\LICENSE
app\node_modules\methods\package.json
app\node_modules\methods\README.md
app\node_modules\mime\src
app\node_modules\mime\.npmignore
app\node_modules\mime\CHANGELOG.md
app\node_modules\mime\cli.js
app\node_modules\mime\LICENSE
app\node_modules\mime\mime.js
app\node_modules\mime\package.json
app\node_modules\mime\README.md
app\node_modules\mime\types.json
app\node_modules\mime\src\build.js
app\node_modules\mime\src\test.js
app\node_modules\mime-db\db.json
app\node_modules\mime-db\HISTORY.md
app\node_modules\mime-db\index.js
app\node_modules\mime-db\LICENSE
app\node_modules\mime-db\package.json
app\node_modules\mime-db\README.md
app\node_modules\mime-types\HISTORY.md
app\node_modules\mime-types\index.js
app\node_modules\mime-types\LICENSE
app\node_modules\mime-types\package.json
app\node_modules\mime-types\README.md
app\node_modules\ms\index.js
app\node_modules\ms\license.md
app\node_modules\ms\package.json
app\node_modules\ms\readme.md
app\node_modules\negotiator\lib
app\node_modules\negotiator\HISTORY.md
app\node_modules\negotiator\index.js
app\node_modules\negotiator\LICENSE
app\node_modules\negotiator\package.json
app\node_modules\negotiator\README.md
app\node_modules\negotiator\lib\charset.js
app\node_modules\negotiator\lib\encoding.js
app\node_modules\negotiator\lib\language.js
app\node_modules\negotiator\lib\mediaType.js
app\node_modules\object-inspect\.github
app\node_modules\object-inspect\example
app\node_modules\object-inspect\test
app\node_modules\object-inspect\.eslintrc
app\node_modules\object-inspect\.nycrc
app\node_modules\object-inspect\CHANGELOG.md
app\node_modules\object-inspect\index.js
app\node_modules\object-inspect\LICENSE
app\node_modules\object-inspect\package-support.json
app\node_modules\object-inspect\package.json
app\node_modules\object-inspect\readme.markdown
app\node_modules\object-inspect\test-core-js.js
app\node_modules\object-inspect\util.inspect.js
app\node_modules\object-inspect\.github\FUNDING.yml
app\node_modules\object-inspect\example\all.js
app\node_modules\object-inspect\example\circular.js
app\node_modules\object-inspect\example\fn.js
app\node_modules\object-inspect\example\inspect.js
app\node_modules\object-inspect\test\browser
app\node_modules\object-inspect\test\bigint.js
app\node_modules\object-inspect\test\circular.js
app\node_modules\object-inspect\test\deep.js
app\node_modules\object-inspect\test\element.js
app\node_modules\object-inspect\test\err.js
app\node_modules\object-inspect\test\fakes.js
app\node_modules\object-inspect\test\fn.js
app\node_modules\object-inspect\test\global.js
app\node_modules\object-inspect\test\has.js
app\node_modules\object-inspect\test\holes.js
app\node_modules\object-inspect\test\indent-option.js
app\node_modules\object-inspect\test\inspect.js
app\node_modules\object-inspect\test\lowbyte.js
app\node_modules\object-inspect\test\number.js
app\node_modules\object-inspect\test\quoteStyle.js
app\node_modules\object-inspect\test\toStringTag.js
app\node_modules\object-inspect\test\undef.js
app\node_modules\object-inspect\test\values.js
app\node_modules\object-inspect\test\browser\dom.js
app\node_modules\on-finished\HISTORY.md
app\node_modules\on-finished\index.js
app\node_modules\on-finished\LICENSE
app\node_modules\on-finished\package.json
app\node_modules\on-finished\README.md
app\node_modules\parseurl\HISTORY.md
app\node_modules\parseurl\index.js
app\node_modules\parseurl\LICENSE
app\node_modules\parseurl\package.json
app\node_modules\parseurl\README.md
app\node_modules\path-to-regexp\index.js
app\node_modules\path-to-regexp\LICENSE
app\node_modules\path-to-regexp\package.json
app\node_modules\path-to-regexp\Readme.md
app\node_modules\prom-client\lib
app\node_modules\prom-client\index.d.ts
app\node_modules\prom-client\index.js
app\node_modules\prom-client\LICENSE
app\node_modules\prom-client\package.json
app\node_modules\prom-client\README.md
app\node_modules\prom-client\lib\metrics
app\node_modules\prom-client\lib\bucketGenerators.js
app\node_modules\prom-client\lib\cluster.js
app\node_modules\prom-client\lib\counter.js
app\node_modules\prom-client\lib\defaultMetrics.js
app\node_modules\prom-client\lib\gauge.js
app\node_modules\prom-client\lib\histogram.js
app\node_modules\prom-client\lib\metric.js
app\node_modules\prom-client\lib\metricAggregators.js
app\node_modules\prom-client\lib\pushgateway.js
app\node_modules\prom-client\lib\registry.js
app\node_modules\prom-client\lib\summary.js
app\node_modules\prom-client\lib\timeWindowQuantiles.js
app\node_modules\prom-client\lib\util.js
app\node_modules\prom-client\lib\validation.js
app\node_modules\prom-client\lib\metrics\helpers
app\node_modules\prom-client\lib\metrics\eventLoopLag.js
app\node_modules\prom-client\lib\metrics\gc.js
app\node_modules\prom-client\lib\metrics\heapSizeAndUsed.js
app\node_modules\prom-client\lib\metrics\heapSpacesSizeAndUsed.js
app\node_modules\prom-client\lib\metrics\osMemoryHeap.js
app\node_modules\prom-client\lib\metrics\osMemoryHeapLinux.js
app\node_modules\prom-client\lib\metrics\processCpuTotal.js
app\node_modules\prom-client\lib\metrics\processHandles.js
app\node_modules\prom-client\lib\metrics\processMaxFileDescriptors.js
app\node_modules\prom-client\lib\metrics\processOpenFileDescriptors.js
app\node_modules\prom-client\lib\metrics\processRequests.js
app\node_modules\prom-client\lib\metrics\processResources.js
app\node_modules\prom-client\lib\metrics\processStartTime.js
app\node_modules\prom-client\lib\metrics\version.js
app\node_modules\prom-client\lib\metrics\helpers\processMetricsHelpers.js
app\node_modules\prom-client\lib\metrics\helpers\safeMemoryUsage.js
app\node_modules\proxy-addr\HISTORY.md
app\node_modules\proxy-addr\index.js
app\node_modules\proxy-addr\LICENSE
app\node_modules\proxy-addr\package.json
app\node_modules\proxy-addr\README.md
app\node_modules\qs\.github
app\node_modules\qs\dist
app\node_modules\qs\lib
app\node_modules\qs\test
app\node_modules\qs\.editorconfig
app\node_modules\qs\.eslintrc
app\node_modules\qs\.nycrc
app\node_modules\qs\CHANGELOG.md
app\node_modules\qs\LICENSE.md
app\node_modules\qs\package.json
app\node_modules\qs\README.md
app\node_modules\qs\.github\FUNDING.yml
app\node_modules\qs\dist\qs.js
app\node_modules\qs\lib\formats.js
app\node_modules\qs\lib\index.js
app\node_modules\qs\lib\parse.js
app\node_modules\qs\lib\stringify.js
app\node_modules\qs\lib\utils.js
app\node_modules\qs\test\empty-keys-cases.js
app\node_modules\qs\test\parse.js
app\node_modules\qs\test\stringify.js
app\node_modules\qs\test\utils.js
app\node_modules\range-parser\HISTORY.md
app\node_modules\range-parser\index.js
app\node_modules\range-parser\LICENSE
app\node_modules\range-parser\package.json
app\node_modules\range-parser\README.md
app\node_modules\raw-body\HISTORY.md
app\node_modules\raw-body\index.d.ts
app\node_modules\raw-body\index.js
app\node_modules\raw-body\LICENSE
app\node_modules\raw-body\package.json
app\node_modules\raw-body\README.md
app\node_modules\raw-body\SECURITY.md
app\node_modules\safe-buffer\index.d.ts
app\node_modules\safe-buffer\index.js
app\node_modules\safe-buffer\LICENSE
app\node_modules\safe-buffer\package.json
app\node_modules\safe-buffer\README.md
app\node_modules\safer-buffer\dangerous.js
app\node_modules\safer-buffer\LICENSE
app\node_modules\safer-buffer\package.json
app\node_modules\safer-buffer\Porting-Buffer.md
app\node_modules\safer-buffer\Readme.md
app\node_modules\safer-buffer\safer.js
app\node_modules\safer-buffer\tests.js
app\node_modules\send\node_modules
app\node_modules\send\HISTORY.md
app\node_modules\send\index.js
app\node_modules\send\LICENSE
app\node_modules\send\package.json
app\node_modules\send\README.md
app\node_modules\send\SECURITY.md
app\node_modules\send\node_modules\encodeurl
app\node_modules\send\node_modules\ms
app\node_modules\send\node_modules\encodeurl\HISTORY.md
app\node_modules\send\node_modules\encodeurl\index.js
app\node_modules\send\node_modules\encodeurl\LICENSE
app\node_modules\send\node_modules\encodeurl\package.json
app\node_modules\send\node_modules\encodeurl\README.md
app\node_modules\send\node_modules\ms\index.js
app\node_modules\send\node_modules\ms\license.md
app\node_modules\send\node_modules\ms\package.json
app\node_modules\send\node_modules\ms\readme.md
app\node_modules\serve-static\HISTORY.md
app\node_modules\serve-static\index.js
app\node_modules\serve-static\LICENSE
app\node_modules\serve-static\package.json
app\node_modules\serve-static\README.md
app\node_modules\setprototypeof\test
app\node_modules\setprototypeof\index.d.ts
app\node_modules\setprototypeof\index.js
app\node_modules\setprototypeof\LICENSE
app\node_modules\setprototypeof\package.json
app\node_modules\setprototypeof\README.md
app\node_modules\setprototypeof\test\index.js
app\node_modules\side-channel\.github
app\node_modules\side-channel\test
app\node_modules\side-channel\.editorconfig
app\node_modules\side-channel\.eslintrc
app\node_modules\side-channel\.nycrc
app\node_modules\side-channel\CHANGELOG.md
app\node_modules\side-channel\index.d.ts
app\node_modules\side-channel\index.js
app\node_modules\side-channel\LICENSE
app\node_modules\side-channel\package.json
app\node_modules\side-channel\README.md
app\node_modules\side-channel\tsconfig.json
app\node_modules\side-channel\.github\FUNDING.yml
app\node_modules\side-channel\test\index.js
app\node_modules\side-channel-list\.github
app\node_modules\side-channel-list\test
app\node_modules\side-channel-list\.editorconfig
app\node_modules\side-channel-list\.eslintrc
app\node_modules\side-channel-list\.nycrc
app\node_modules\side-channel-list\CHANGELOG.md
app\node_modules\side-channel-list\index.d.ts
app\node_modules\side-channel-list\index.js
app\node_modules\side-channel-list\LICENSE
app\node_modules\side-channel-list\list.d.ts
app\node_modules\side-channel-list\package.json
app\node_modules\side-channel-list\README.md
app\node_modules\side-channel-list\tsconfig.json
app\node_modules\side-channel-list\.github\FUNDING.yml
app\node_modules\side-channel-list\test\index.js
app\node_modules\side-channel-map\.github
app\node_modules\side-channel-map\test
app\node_modules\side-channel-map\.editorconfig
app\node_modules\side-channel-map\.eslintrc
app\node_modules\side-channel-map\.nycrc
app\node_modules\side-channel-map\CHANGELOG.md
app\node_modules\side-channel-map\index.d.ts
app\node_modules\side-channel-map\index.js
app\node_modules\side-channel-map\LICENSE
app\node_modules\side-channel-map\package.json
app\node_modules\side-channel-map\README.md
app\node_modules\side-channel-map\tsconfig.json
app\node_modules\side-channel-map\.github\FUNDING.yml
app\node_modules\side-channel-map\test\index.js
app\node_modules\side-channel-weakmap\.github
app\node_modules\side-channel-weakmap\test
app\node_modules\side-channel-weakmap\.editorconfig
app\node_modules\side-channel-weakmap\.eslintrc
app\node_modules\side-channel-weakmap\.nycrc
app\node_modules\side-channel-weakmap\CHANGELOG.md
app\node_modules\side-channel-weakmap\index.d.ts
app\node_modules\side-channel-weakmap\index.js
app\node_modules\side-channel-weakmap\LICENSE
app\node_modules\side-channel-weakmap\package.json
app\node_modules\side-channel-weakmap\README.md
app\node_modules\side-channel-weakmap\tsconfig.json
app\node_modules\side-channel-weakmap\.github\FUNDING.yml
app\node_modules\side-channel-weakmap\test\index.js
app\node_modules\statuses\codes.json
app\node_modules\statuses\HISTORY.md
app\node_modules\statuses\index.js
app\node_modules\statuses\LICENSE
app\node_modules\statuses\package.json
app\node_modules\statuses\README.md
app\node_modules\tdigest\dist
app\node_modules\tdigest\specs
app\node_modules\tdigest\.travis.yml
app\node_modules\tdigest\distributions.js
app\node_modules\tdigest\example.html
app\node_modules\tdigest\example.js
app\node_modules\tdigest\gruntfile.js
app\node_modules\tdigest\LICENSE
app\node_modules\tdigest\package.json
app\node_modules\tdigest\README.md
app\node_modules\tdigest\tdigest.js
app\node_modules\tdigest\dist\tdigest.js
app\node_modules\tdigest\specs\digest.spec.js
app\node_modules\tdigest\specs\discrete.spec.js
app\node_modules\tdigest\specs\tdigest.spec.js
app\node_modules\toidentifier\HISTORY.md
app\node_modules\toidentifier\index.js
app\node_modules\toidentifier\LICENSE
app\node_modules\toidentifier\package.json
app\node_modules\toidentifier\README.md
app\node_modules\type-is\HISTORY.md
app\node_modules\type-is\index.js
app\node_modules\type-is\LICENSE
app\node_modules\type-is\package.json
app\node_modules\type-is\README.md
app\node_modules\unpipe\HISTORY.md
app\node_modules\unpipe\index.js
app\node_modules\unpipe\LICENSE
app\node_modules\unpipe\package.json
app\node_modules\unpipe\README.md
app\node_modules\utils-merge\.npmignore
app\node_modules\utils-merge\index.js
app\node_modules\utils-merge\LICENSE
app\node_modules\utils-merge\package.json
app\node_modules\utils-merge\README.md
app\node_modules\vary\HISTORY.md
app\node_modules\vary\index.js
app\node_modules\vary\LICENSE
app\node_modules\vary\package.json
app\node_modules\vary\README.md
app\public\index.html
audit\app
audit\demo
audit\demo_audit
audit\app\repo_audit_20251019_123351.txt
audit\app\repo_audit_20251019_130056.txt
audit\demo\images
audit\demo\5xx.csv
audit\demo\cpu.csv
audit\demo\mem.csv
audit\demo\p95.csv
audit\demo\report.html
audit\demo\report.pdf
audit\demo\rps.csv
audit\demo\images\panel_11.png
audit\demo\images\panel_12.png
audit\demo\images\panel_13.png
audit\demo\images\panel_14.png
audit\demo\images\panel_15.png
audit\demo\images\panel_16.png
audit\demo_audit\images
audit\demo_audit\share-kit
audit\demo_audit\5xx.csv
audit\demo_audit\alerts.json
audit\demo_audit\cpu.csv
audit\demo_audit\demo_.gif
audit\demo_audit\demo.gif
audit\demo_audit\devops-proof.zip
audit\demo_audit\diagnostics.txt
audit\demo_audit\mem.csv
audit\demo_audit\p95.csv
audit\demo_audit\report.html
audit\demo_audit\report.pdf
audit\demo_audit\rps.csv
audit\demo_audit\share-kit.zip
audit\demo_audit\targets.json
audit\demo_audit\images\panel_01.png
audit\demo_audit\images\panel_02.png
audit\demo_audit\images\panel_03.png
audit\demo_audit\images\panel_04.png
audit\demo_audit\images\panel_05.png
audit\demo_audit\images\panel_06.png
audit\demo_audit\share-kit\share_charts
audit\demo_audit\share-kit\cpu.csv
audit\demo_audit\share-kit\demo.gif
audit\demo_audit\share-kit\mem.csv
audit\demo_audit\share-kit\README-share-kit.md
audit\demo_audit\share-kit\report.html
audit\demo_audit\share-kit\report.pdf
audit\demo_audit\share-kit\rps.csv
audit\demo_audit\share-kit\share_charts\cpu.png
audit\demo_audit\share-kit\share_charts\mem.png
audit\demo_audit\share-kit\share_charts\rps.png
docs\README_AUDIT_DEMO.md
k8s\deployment.yaml
k8s\hpa.yaml
k8s\ingress.yaml
k8s\monitoring-fix.yaml
k8s\pdb.yaml
k8s\sa.yaml
k8s\service.yaml
monitoring\grafana
monitoring\alertmanager.yml
monitoring\grafana-ingress.yaml
monitoring\podmonitor-app.yaml
monitoring\prometheus.rules.yml
monitoring\prometheus.yml
monitoring\prometheusrule.yaml
monitoring\grafana\dashboards
monitoring\grafana\datasources
monitoring\grafana\dashboards\doctrine-demo.json
monitoring\grafana\dashboards\grafana_capture_ecran_2.png
monitoring\grafana\dashboards\grafana_capture_ecran.png
monitoring\grafana\dashboards\node_api.json
monitoring\grafana\datasources\grafana-datasource-prom.yaml
scripts\audit_full_fix.ps1
scripts\audit_png_csv.ps1
scripts\audit.ps1
scripts\bootstrap.ps1
scripts\codex_audit_fixed.ps1
scripts\codex_audit.ps1
scripts\demo.ps1
scripts\dev_tunnel.ps1
scripts\encode_kubeconfig.ps1
scripts\gen_traffic.ps1
scripts\k6.js
scripts\patch_latency.ps1
scripts\pf_keepalive.ps1
scripts\pf_strong.ps1
scripts\run_demo.ps1
scripts\simulate_failure.ps1
scripts\simulate_load.ps1
scripts\tunnel.ps1
terraform\eks
terraform\k3d
terraform\eks\main.tf
terraform\eks\outputs.tf
terraform\eks\variables.tf
terraform\k3d\main.tf
terraform\k3d\outputs.tf
terraform\k3d\versions.tf

===== Métriques de code (par extension) =====
            files=   76  loc= 221467  size=   2 374 764 bytes
.cmd        files=    1  loc=     15  size=         316 bytes
.csv        files=   13  loc=     48  size=       2 638 bytes
.dockerignore  files=    1  loc=     13  size=         159 bytes
.editorconfig  files=    5  loc=     67  size=       1 177 bytes
.eslintrc   files=   21  loc=    308  size=       5 949 bytes
.example    files=    1  loc=      2  size=          23 bytes
.gif        files=    4  loc=   2940  size=     318 609 bytes
.gitattributes  files=    1  loc=      9  size=         291 bytes
.gitignore  files=    1  loc=     17  size=         269 bytes
.html       files=    6  loc=   1482  size=      82 508 bytes
.js         files=  261  loc=  29184  size=   1 022 904 bytes
.json       files=  110  loc=  15838  size=   3 895 713 bytes
.markdown   files=    1  loc=     61  size=       2 988 bytes
.md         files=  143  loc=  16326  size=     758 210 bytes
.npmignore  files=    5  loc=     22  size=         193 bytes
.nycrc      files=   15  loc=    171  size=       2 798 bytes
.pdf        files=    3  loc=  19539  size=   1 956 288 bytes
.png        files=   17  loc=   5022  size=     862 911 bytes
.ps1        files=   18  loc=   1180  size=      67 478 bytes
.tf         files=    6  loc=     32  size=       1 266 bytes
.ts         files=   55  loc=   1235  size=      44 902 bytes
.txt        files=    4  loc=   2080  size=      83 231 bytes
.yaml       files=   11  loc=    225  size=       5 210 bytes
.yml        files=   27  loc=    338  size=      14 718 bytes
.zip        files=    2  loc=   9949  size=   1 349 254 bytes

===== Inventaire ciblé =====
Dockerfiles:
  - app\Dockerfile
  - Dockerfile
Compose:
K8s Manifests:
  - k8s\deployment.yaml
  - k8s\hpa.yaml
  - k8s\ingress.yaml
  - k8s\monitoring-fix.yaml
  - k8s\pdb.yaml
  - k8s\sa.yaml
  - k8s\service.yaml
Monitoring (Graf/Prom/AM):
  - monitoring\grafana\dashboards\doctrine-demo.json
  - monitoring\grafana\dashboards\node_api.json
  - monitoring\grafana\datasources\grafana-datasource-prom.yaml
  - monitoring\alertmanager.yml
  - monitoring\grafana-ingress.yaml
  - monitoring\podmonitor-app.yaml
  - monitoring\prometheus.rules.yml
  - monitoring\prometheus.yml
  - monitoring\prometheusrule.yaml
Dashboards Grafana (.json):
  - monitoring\grafana\dashboards\doctrine-demo.json
  - monitoring\grafana\dashboards\node_api.json
Scripts PowerShell:
  - app\node_modules\.bin\mime.ps1
  - scripts\audit_full_fix.ps1
  - scripts\audit_png_csv.ps1
  - scripts\audit.ps1
  - scripts\bootstrap.ps1
  - scripts\codex_audit_fixed.ps1
  - scripts\codex_audit.ps1
  - scripts\demo.ps1
  - scripts\dev_tunnel.ps1
  - scripts\encode_kubeconfig.ps1
  - scripts\gen_traffic.ps1
  - scripts\patch_latency.ps1
  - scripts\pf_keepalive.ps1
  - scripts\pf_strong.ps1
  - scripts\run_demo.ps1
  - scripts\simulate_failure.ps1
  - scripts\simulate_load.ps1
  - scripts\tunnel.ps1

===== Index des fichiers inclus (contenu intégral) =====
[001] app\Dockerfile
[002] Dockerfile
[003] k8s\deployment.yaml
[004] k8s\hpa.yaml
[005] k8s\ingress.yaml
[006] k8s\monitoring-fix.yaml
[007] k8s\pdb.yaml
[008] k8s\sa.yaml
[009] k8s\service.yaml
[010] monitoring\alertmanager.yml
[011] monitoring\grafana-ingress.yaml
[012] monitoring\grafana\dashboards\doctrine-demo.json
[013] monitoring\grafana\dashboards\node_api.json
[014] monitoring\grafana\datasources\grafana-datasource-prom.yaml
[015] monitoring\podmonitor-app.yaml
[016] monitoring\prometheus.rules.yml
[017] monitoring\prometheus.yml
[018] monitoring\prometheusrule.yaml
[019] scripts\audit_full_fix.ps1
[020] scripts\gen_traffic.ps1
[021] scripts\pf_keepalive.ps1

===== Contenu intégral des fichiers clés =====

----- [001] app\Dockerfile -----
    1: FROM node:20-alpine AS build
    2: WORKDIR /app
    3: COPY package*.json ./
    4: RUN npm ci --omit=dev
    5: COPY . .
    6: # Optionnel: tests unitaires si présents, sinon ignorer
    7: # RUN npm test || echo "no tests"
    8: 
    9: FROM node:20-alpine
   10: WORKDIR /app
   11: COPY --from=build /app /app
   12: RUN addgroup -g 10001 app && adduser -D -u 10001 -G app app
   13: USER 10001
   14: ENV NODE_ENV=production
   15: EXPOSE 8080
   16: HEALTHCHECK --interval=10s --timeout=2s --retries=3 \
   17:   CMD wget -qO- http://127.0.0.1:8080/healthz || exit 1
   18: CMD ["node", "index.js"]

----- [002] Dockerfile -----
    1: # Image de base légère
    2: FROM node:20-alpine
    3: 
    4: # Exécuter en prod
    5: ENV NODE_ENV=production
    6: 
    7: # Dossier de travail
    8: WORKDIR /app
    9: 
   10: # Dépendances (utilise le lockfile s'il est présent)
   11: COPY app/package*.json ./
   12: RUN npm ci --omit=dev --no-audit --no-fund
   13: 
   14: # Copie du code
   15: COPY app/ ./
   16: 
   17: # Crée un user/groupe non-root avec UID/GID = 10001 et donne les droits
   18: RUN addgroup -g 10001 app \
   19:     && adduser -D -u 10001 -G app app \
   20:     && chown -R 10001:10001 /app
   21: 
   22: # Basculer définitivement en non-root
   23: USER 10001
   24: 
   25: # Port exposé par l'app
   26: EXPOSE 8080
   27: 
   28: # Commande de démarrage
   29: CMD ["node", "index.js"]

----- [003] k8s\deployment.yaml -----
    1: apiVersion: apps/v1
    2: kind: Deployment
    3: metadata:
    4:   name: doctrine-demo
    5:   labels: { app: doctrine-demo }
    6: spec:
    7:   replicas: 2
    8:   selector:
    9:     matchLabels: { app: doctrine-demo }
   10:   template:
   11:     metadata:
   12:       labels: { app: doctrine-demo }
   13:       annotations:
   14:         prometheus.io/scrape: "true"
   15:         prometheus.io/port: "8080"
   16:         prometheus.io/path: "/metrics"
   17:     spec:
   18:       serviceAccountName: doctrine-demo
   19:       securityContext:
   20:         runAsUser: 10001
   21:         runAsNonRoot: true
   22:         fsGroup: 10001
   23:       terminationGracePeriodSeconds: 30
   24:       containers:
   25:         - name: app
   26:           image: ghcr.io/ORG/doctrine-demo:latest
   27:           imagePullPolicy: Always
   28:           ports: [{ containerPort: 8080 }]
   29:           securityContext:
   30:             allowPrivilegeEscalation: false
   31:           env:
   32:             - name: LATENCY_MS
   33:               valueFrom:
   34:                 configMapKeyRef:
   35:                   name: doctrine-demo-config
   36:                   key: latency_ms
   37:           resources:
   38:             requests: { cpu: "100m", memory: "128Mi" }
   39:             limits: { cpu: "500m", memory: "256Mi" }
   40:           livenessProbe:
   41:             httpGet: { path: /healthz, port: 8080 }
   42:             initialDelaySeconds: 5
   43:             periodSeconds: 10
   44:           readinessProbe:
   45:             httpGet: { path: /healthz, port: 8080 }
   46:             initialDelaySeconds: 3
   47:             periodSeconds: 10
   48: ---
   49: apiVersion: v1
   50: kind: ConfigMap
   51: metadata:
   52:   name: doctrine-demo-config
   53: data:
   54:   latency_ms: "0"  # mettre "300" pour déclencher l'alerte p95

----- [004] k8s\hpa.yaml -----
    1: apiVersion: autoscaling/v2
    2: kind: HorizontalPodAutoscaler
    3: metadata:
    4:   name: doctrine-demo-hpa
    5: spec:
    6:   scaleTargetRef:
    7:     apiVersion: apps/v1
    8:     kind: Deployment
    9:     name: doctrine-demo
   10:   minReplicas: 2
   11:   maxReplicas: 6
   12:   metrics:
   13:     - type: Resource
   14:       resource:
   15:         name: cpu
   16:         target:
   17:           type: Utilization
   18:           averageUtilization: 60

----- [005] k8s\ingress.yaml -----
    1: apiVersion: networking.k8s.io/v1
    2: kind: Ingress
    3: metadata:
    4:   name: doctrine-demo-ing
    5:   annotations:
    6:     nginx.ingress.kubernetes.io/proxy-body-size: "4m"
    7:     # Activer cert-manager une fois le certificat disponible :
    8:     # cert-manager.io/cluster-issuer: letsencrypt
    9: spec:
   10:   ingressClassName: nginx
   11:   rules:
   12:     - host: demo.ton-domaine.dev
   13:       http:
   14:         paths:
   15:           - path: /
   16:             pathType: Prefix
   17:             backend:
   18:               service:
   19:                 name: doctrine-demo-svc
   20:                 port:
   21:                   number: 80

----- [006] k8s\monitoring-fix.yaml -----
    1: apiVersion: v1
    2: kind: Service
    3: metadata:
    4:   name: doctrine-demo-svc
    5:   namespace: default
    6:   labels:
    7:     app: doctrine-demo
    8: spec:
    9:   selector:
   10:     app: doctrine-demo
   11:   ports:
   12:     - name: http
   13:       port: 80
   14:       targetPort: 8080 # ← ton container expose 8080
   15:       protocol: TCP
   16: ---
   17: apiVersion: monitoring.coreos.com/v1
   18: kind: ServiceMonitor
   19: metadata:
   20:   name: doctrine-demo
   21:   namespace: monitoring
   22:   labels:
   23:     release: kpstack
   24: spec:
   25:   namespaceSelector:
   26:     matchNames: ['default']
   27:   selector:
   28:     matchLabels:
   29:       app: doctrine-demo
   30:   endpoints:
   31:     - port: http
   32:       path: /metrics
   33:       scheme: http
   34:       interval: 15s
   35:       honorLabels: true

----- [007] k8s\pdb.yaml -----
    1: apiVersion: policy/v1
    2: kind: PodDisruptionBudget
    3: metadata:
    4:   name: doctrine-demo
    5: spec:
    6:   minAvailable: 1
    7:   selector:
    8:     matchLabels:
    9:       app: doctrine-demo

----- [008] k8s\sa.yaml -----
    1: apiVersion: v1
    2: kind: ServiceAccount
    3: metadata:
    4:   name: doctrine-demo

----- [009] k8s\service.yaml -----
    1: apiVersion: v1
    2: kind: Service
    3: metadata:
    4:   name: doctrine-demo-svc
    5:   labels: { app: doctrine-demo }
    6: spec:
    7:   type: ClusterIP
    8:   selector: { app: doctrine-demo }
    9:   ports:
   10:     - name: http
   11:       port: 80
   12:       targetPort: 8080

----- [010] monitoring\alertmanager.yml -----
    1: route:
    2:   receiver: 'default'
    3:   group_interval: 2m
    4:   repeat_interval: 30m
    5: 
    6: receivers:
    7:   - name: 'default'
    8:     # Décommente l’un des blocs et renseigne la conf :
    9:     # slack_configs:
   10:     #   - api_url: 'https://hooks.slack.com/services/XXXX/XXXX/XXXX'
   11:     #     channel: '#alerts'
   12:     # email_configs:
   13:     #   - to: 'you@example.com'
   14:     #     from: 'alertmanager@example.com'
   15:     #     smarthost: 'smtp.example.com:587'
   16:     #     auth_username: 'user'
   17:     #     auth_identity: 'user'
   18:     #     auth_password: 'pass'

----- [011] monitoring\grafana-ingress.yaml -----
    1: ---
    2: apiVersion: networking.k8s.io/v1
    3: kind: Ingress
    4: metadata:
    5:   name: grafana-ing
    6:   namespace: monitoring
    7:   annotations:
    8:     nginx.ingress.kubernetes.io/proxy-body-size: "4m"
    9: spec:
   10:   ingressClassName: nginx
   11:   rules:
   12:   - host: grafana.ton-domaine.dev
   13:     http:
   14:       paths:
   15:       - path: /
   16:         pathType: Prefix
   17:         backend:
   18:           service:
   19:             name: kps-grafana
   20:             port:
   21:               number: 80

----- [012] monitoring\grafana\dashboards\doctrine-demo.json -----
    1: {
    2:   "title": "Doctrine Demo - App Overview",
    3:   "schemaVersion": 38,
    4:   "version": 1,
    5:   "panels": [
    6:     {
    7:       "type": "graph",
    8:       "title": "Requests / s",
    9:       "targets": [
   10:         {
   11:           "expr": "rate(http_requests_total[1m])",
   12:           "legendFormat": "{{route}} {{method}} {{code}}"
   13:         }
   14:       ],
   15:       "id": 1
   16:     },
   17:     {
   18:       "type": "graph",
   19:       "title": "Latency p95 (s) /search",
   20:       "targets": [
   21:         {
   22:           "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket{route=\"/search\"}[1m])) by (le))",
   23:           "legendFormat": "p95 /search"
   24:         }
   25:       ],
   26:       "id": 2
   27:     },
   28:     {
   29:       "type": "graph",
   30:       "title": "CPU (pods)",
   31:       "targets": [
   32:         {
   33:           "expr": "sum(rate(container_cpu_usage_seconds_total{image!=\"\",pod=~\"doctrine-demo.*\"}[1m]))",
   34:           "legendFormat": "CPU"
   35:         }
   36:       ],
   37:       "id": 3
   38:     },
   39:     {
   40:       "type": "graph",
   41:       "title": "Memory (pods)",
   42:       "targets": [
   43:         {
   44:           "expr": "sum(container_memory_working_set_bytes{image!=\"\",pod=~\"doctrine-demo.*\"})",
   45:           "legendFormat": "Mem"
   46:         }
   47:       ],
   48:       "id": 4
   49:     }
   50:   ],
   51:   "time": { "from": "now-15m", "to": "now" }
   52: }

----- [013] monitoring\grafana\dashboards\node_api.json -----
    1: {
    2:   "title": "Node API - Doctrine Demo",
    3:   "uid": "node-api-doctrine",
    4:   "schemaVersion": 38,
    5:   "version": 1,
    6:   "refresh": "10s",
    7:   "time": { "from": "now-1h", "to": "now" },
    8:   "panels": [
    9:     {
   10:       "id": 1,
   11:       "type": "timeseries",
   12:       "title": "Requests per second",
   13:       "datasource": { "type": "prometheus", "uid": "PROMETHEUS_DS" },
   14:       "targets": [
   15:         {
   16:           "expr": "sum(rate(http_requests_total[1m])) by (route)",
   17:           "legendFormat": "{{route}}"
   18:         }
   19:       ],
   20:       "gridPos": { "h": 8, "w": 12, "x": 0, "y": 0 }
   21:     },
   22:     {
   23:       "id": 2,
   24:       "type": "timeseries",
   25:       "title": "Latency p95 (s)",
   26:       "datasource": { "type": "prometheus", "uid": "PROMETHEUS_DS" },
   27:       "targets": [
   28:         {
   29:           "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le, route))",
   30:           "legendFormat": "{{route}}"
   31:         }
   32:       ],
   33:       "gridPos": { "h": 8, "w": 12, "x": 12, "y": 0 }
   34:     },
   35:     {
   36:       "id": 3,
   37:       "type": "timeseries",
   38:       "title": "HTTP 5xx rate",
   39:       "datasource": { "type": "prometheus", "uid": "PROMETHEUS_DS" },
   40:       "targets": [
   41:         {
   42:           "expr": "sum(rate(http_requests_total{code=~\"5..\"}[5m])) by (route)",
   43:           "legendFormat": "{{route}}"
   44:         }
   45:       ],
   46:       "gridPos": { "h": 8, "w": 12, "x": 0, "y": 8 }
   47:     },
   48:     {
   49:       "id": 4,
   50:       "type": "timeseries",
   51:       "title": "Pod CPU / Memory",
   52:       "datasource": { "type": "prometheus", "uid": "PROMETHEUS_DS" },
   53:       "targets": [
   54:         {
   55:           "expr": "sum(rate(container_cpu_usage_seconds_total{image!=\"\", pod=~\"doctrine-demo.*\"}[5m]))",
   56:           "legendFormat": "CPU"
   57:         },
   58:         {
   59:           "expr": "sum(container_memory_working_set_bytes{image!=\"\", pod=~\"doctrine-demo.*\"})",
   60:           "legendFormat": "Memory"
   61:         }
   62:       ],
   63:       "gridPos": { "h": 8, "w": 12, "x": 12, "y": 8 }
   64:     }
   65:   ],
   66:   "annotations": {
   67:     "list": [
   68:       {
   69:         "builtIn": 1,
   70:         "datasource": { "type": "grafana", "uid": "-- Grafana --" },
   71:         "enable": true,
   72:         "hide": true,
   73:         "iconColor": "rgba(0, 211, 255, 1)",
   74:         "name": "Annotations & Alerts",
   75:         "type": "dashboard"
   76:       }
   77:     ]
   78:   }
   79: }

----- [014] monitoring\grafana\datasources\grafana-datasource-prom.yaml -----
    1: apiVersion: v1
    2: kind: ConfigMap
    3: metadata:
    4:   name: grafana-datasource-prom
    5:   namespace: monitoring
    6:   labels:
    7:     grafana_datasource: "1"
    8: data:
    9:   prometheus.yaml: |
   10:     apiVersion: 1
   11:     datasources:
   12:       - name: Prometheus
   13:         type: prometheus
   14:         access: proxy
   15:         isDefault: true
   16:         url: http://kpstack-kube-prometheus-st-prometheus.monitoring.svc:9090
   17:         editable: false

----- [015] monitoring\podmonitor-app.yaml -----
    1: ---
    2: apiVersion: monitoring.coreos.com/v1
    3: kind: PodMonitor
    4: metadata:
    5:   name: doctrine-demo
    6:   namespace: monitoring
    7: spec:
    8:   namespaceSelector:
    9:     matchNames: ["default"]
   10:   selector:
   11:     matchLabels:
   12:       app: doctrine-demo
   13:   podMetricsEndpoints:
   14:     - targetPort: 8080
   15:       path: /metrics
   16:       interval: 15s

----- [016] monitoring\prometheus.rules.yml -----
    1: groups:
    2: - name: doctrine-demo-alerts
    3:   rules:
    4:   - alert: HighP95Latency
    5:     expr: histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket{route="/search"}[2m])) by (le))
    6:           > 0.3
    7:     for: 2m
    8:     labels:
    9:       severity: warning
   10:     annotations:
   11:       summary: "p95 search latency > 300ms"
   12:       description: "p95 over last 2m is {{ $value }}s"

----- [017] monitoring\prometheus.yml -----
    1: global:
    2:   scrape_interval: 15s
    3: scrape_configs:
    4:   - job_name: 'doctrine-demo'
    5:     kubernetes_sd_configs:
    6:       - role: pod
    7:     relabel_configs:
    8:       - source_labels: [__meta_kubernetes_pod_label_app]
    9:         action: keep
   10:         regex: doctrine-demo
   11:       - source_labels: [__meta_kubernetes_pod_container_port_number]
   12:         action: keep
   13:         regex: "8080"
   14:       - source_labels: [__meta_kubernetes_pod_ip]
   15:         target_label: __address__
   16:         replacement: $1:8080
   17: rule_files:
   18:   - /etc/prometheus/prometheus.rules.yml

----- [018] monitoring\prometheusrule.yaml -----
    1: ---
    2: apiVersion: monitoring.coreos.com/v1
    3: kind: PrometheusRule
    4: metadata:
    5:   name: doctrine-demo-rules
    6:   namespace: monitoring
    7: spec:
    8:   groups:
    9:   - name: doctrine-demo-alerts
   10:     rules:
   11:     - alert: HighP95Latency
   12:       expr: histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket{route="/search"}[2m])) by (le)) > 0.3
   13:       for: 2m
   14:       labels:
   15:         severity: warning
   16:       annotations:
   17:         summary: "p95 search latency > 300ms"
   18:         description: "p95 over last 2m is {{ $value }}s"

----- [019] scripts\audit_full_fix.ps1 -----
    1: param(
    2:     [string]$OutRoot = "C:\ATLAS\INBOX\dev\devops\platform_lite\doctrine-demo-platform-lite\audit\demo_audit",
    3:     [string]$MonNs = "monitoring",
    4:     [string]$AppNs = "default"
    5: )
    6: 
    7: $ErrorActionPreference = "Stop"
    8: $GFPort = 3000; $PMPort = 9090; $AMPort = 9093; $OrgId = 1
    9: $Width = 1600; $Height = 900
   10: $From = "now-8h"; $To = "now"
   11: $TZ = [uri]::EscapeDataString("Europe/Paris")
   12: $DashUid = "devops-proof-auto"
   13: $DashTitle = "DevOps Proof"
   14: 
   15: # --- dossiers
   16: New-Item -ItemType Directory -Force -Path $OutRoot | Out-Null
   17: $ImgDir = Join-Path $OutRoot "images"; New-Item -ItemType Directory -Force -Path $ImgDir | Out-Null
   18: $Diag = Join-Path $OutRoot "diagnostics.txt"; Remove-Item $Diag -ErrorAction SilentlyContinue
   19: function W($m) { $ts = (Get-Date).ToString("u"); "$ts  $m" | Tee-Object -FilePath $Diag -Append }
   20: 
   21: # --- PF services du chart kpstack
   22: Get-CimInstance win32_process -Filter "name='kubectl.exe' AND commandline LIKE '%port-forward%'" | Invoke-CimMethod -MethodName Terminate | Out-Null
   23: Start-Process -WindowStyle Hidden powershell -ArgumentList "kubectl -n $MonNs port-forward svc/kpstack-grafana  $GFPort:80" | Out-Null
   24: Start-Process -WindowStyle Hidden powershell -ArgumentList "kubectl -n $MonNs port-forward svc/kpstack-kube-prometheus-st-prometheus $PMPort:9090" | Out-Null
   25: Start-Process -WindowStyle Hidden powershell -ArgumentList "kubectl -n $MonNs port-forward svc/kpstack-kube-prometheus-st-alertmanager $AMPort:9093" | Out-Null
   26: Start-Sleep 4
   27: 
   28: # --- Health checks
   29: foreach ($u in "http://localhost:$GFPort/api/health", "http://localhost:$PMPort/-/healthy", "http://localhost:$AMPort/-/healthy") {
   30:     try { Invoke-WebRequest $u -UseBasicParsing -TimeoutSec 6 | Out-Null; W "OK $u" } catch { W "KO $u -> $($_.Exception.Message)" }
   31: }
   32: 
   33: # --- Auth Grafana
   34: try {
   35:     $pwdB64 = kubectl -n $MonNs get secret kpstack-grafana -o jsonpath="{.data.admin-password}"
   36:     $pwd = [Text.Encoding]::UTF8.GetString([Convert]::FromBase64String($pwdB64))
   37: }
   38: catch { $pwd = "prom-operator" }
   39: $GFHdr = @{ Authorization = "Basic " + [Convert]::ToBase64String([Text.Encoding]::ASCII.GetBytes("admin:$pwd")) }
   40: 
   41: # --- Dashboard (par UID puis fallback recherche)
   42: $dash = $null
   43: try {
   44:     $byUid = Invoke-WebRequest "http://localhost:$GFPort/api/dashboards/uid/$DashUid" -Headers $GFHdr -UseBasicParsing -TimeoutSec 10
   45:     if ($byUid.StatusCode -eq 200) { $dash = ($byUid.Content | ConvertFrom-Json).dashboard }
   46: }
   47: catch {}
   48: if (-not $dash) {
   49:     $res = Invoke-WebRequest "http://localhost:$GFPort/api/search?query=$( [uri]::EscapeDataString($DashTitle) )" -Headers $GFHdr -UseBasicParsing -TimeoutSec 10
   50:     $hit = ($res.Content | ConvertFrom-Json) | Select-Object -First 1
   51:     if (-not $hit) { throw "Dashboard introuvable" }
   52:     $uid = $hit.uid; $slug = $hit.uri.Split('/')[-1]
   53: }
   54: else {
   55:     $uid = $dash.uid; $slug = ($dash.title -replace "[^\w\s-]", "" -replace "\s+", "-").ToLower()
   56: }
   57: W "Dashboard UID=$uid slug=$slug"
   58: 
   59: # --- Renderer
   60: try { $r = Invoke-WebRequest "http://localhost:$GFPort/render/health" -Headers $GFHdr -UseBasicParsing -TimeoutSec 6; W "Renderer: $($r.StatusCode)" } catch { W "Renderer KO: $($_.Exception.Message)" }
   61: 
   62: function Render-Panel([int]$panelId) {
   63:     $url = "http://localhost:$GFPort/render/d-solo/$uid/$slug?orgId=$OrgId&from=$From&to=$To&tz=$TZ&panelId=$panelId&width=$Width&height=$Height&theme=dark"
   64:     $out = Join-Path $ImgDir ("panel_{0:00}.png" -f $panelId)
   65:     foreach ($t in 40, 90, 150) {
   66:         try {
   67:             Invoke-WebRequest -Uri $url -OutFile $out -Headers $GFHdr -UseBasicParsing -TimeoutSec $t
   68:             if ((Get-Item $out).Length -gt 0) { W "PNG ok p$panelId (t=$t) -> $out"; return }
   69:         }
   70:         catch { W "PNG fail p$panelId (t=$t): $($_.Exception.Message)" }
   71:         Start-Sleep 2
   72:     }
   73:     throw "Panel $panelId non rendu"
   74: }
   75: 
   76: $fail = 0; 1..6 | % { try { Render-Panel $_ }catch { $fail++; W $_ } }
   77: W "Panels KO: $fail"
   78: 
   79: # --- Prometheus helpers
   80: function Get-Range($expr, $step = "30s") {
   81:     $qe = [uri]::EscapeDataString($expr)
   82:     $start = (Get-Date).AddHours(-8).ToUniversalTime().ToString("o")
   83:     $end = (Get-Date).ToUniversalTime().ToString("o")
   84:     $u = "http://localhost:$PMPort/api/v1/query_range?query=$qe&start=$start&end=$end&step=$step"
   85:     (($c = Invoke-WebRequest $u -UseBasicParsing -TimeoutSec 25).Content | ConvertFrom-Json).data.result
   86: }
   87: 
   88: function First-NonEmpty([string[]]$cands) {
   89:     foreach ($e in $cands) {
   90:         try {
   91:             $r = Get-Range $e
   92:             if ($r -and $r.Count -gt 0) { return @{ expr = $e; result = $r } }
   93:         }
   94:         catch { W "Query fail: $e -> $($_.Exception.Message)" }
   95:     }
   96:     return $null
   97: }
   98: 
   99: function Summarize($s){
  100:   if ($null -eq $s -or $null -eq $s.metric) {
  101:     return [pscustomobject]@{ series="unknown"; last=$null; max=$null; avg=$null }
  102:   }
  103:   $names = ($s.metric | Get-Member -MemberType NoteProperty | % Name)
  104:   $pairs = foreach($n in $names){ "$n=$($s.metric.$n)" }
  105:   $label = ($pairs -join ",")
  106:   $vals = @()
  107:   foreach($v in $s.values){ $d=[double]$v[1]; if(-not [double]::IsNaN($d)){ $vals += $d } }
  108:   if($vals.Count -eq 0){ return [pscustomobject]@{ series=$label; last=$null; max=$null; avg=$null } }
  109:   [pscustomobject]@{
  110:     series=$label
  111:     last=[Math]::Round($vals[-1],4)
  112:     max=[Math]::Round(($vals|Measure-Object -Maximum).Maximum,4)
  113:     avg=[Math]::Round(($vals|Measure-Object -Average).Average,4)
  114:   }
  115: }
  116: 
  117: function Write-ZeroCsv($path) { @([pscustomobject]@{series = "none"; last = 0; max = 0; avg = 0 }) | Export-Csv -NoTypeInformation -Encoding UTF8 $path }
  118: 
  119: # --- Candidats de requêtes (élargis)
  120: $C_RPS = @(
  121:  'sum by (method,route,path,uri,handler) (rate((http_requests_total OR http_server_requests_seconds_count)[1m]))',
  122:  'sum by (path) (rate(http_server_requests_seconds_count[1m]))',
  123:  'sum(rate(http_requests_total[1m])) by (route)'
  124: )
  125: 
  126: $C_P95 = @(
  127:  'histogram_quantile(0.95, sum by (le,route,path,uri,handler) (rate((http_request_duration_seconds_bucket OR http_server_requests_seconds_bucket OR request_duration_seconds_bucket)[5m])))',
  128:  'max(http_request_duration_seconds{quantile="0.95"})'
  129: )
  130: 
  131: $C_5XX = @(
  132:  'sum by (route,path,uri,handler,method) (rate((http_requests_total{code=~"5.."} OR http_requests_total{status=~"5.."} OR http_server_requests_seconds_count{status=~"5.."})[5m]))',
  133:  'sum by (verb,resource,code) (rate(apiserver_request_total{code=~"5.."}[5m]))'
  134: )
  135: 
  136: $C_CPU = @('sum by (pod) (rate(container_cpu_usage_seconds_total{pod=~"doctrine-demo.*"}[5m]))')
  137: $C_MEM = @('max by (pod) (container_memory_working_set_bytes{pod=~"doctrine-demo.*"})')
  138: 
  139: $RPS = First-NonEmpty $C_RPS
  140: $P95 = First-NonEmpty $C_P95
  141: $E5X = First-NonEmpty $C_5XX
  142: $CPU = First-NonEmpty $C_CPU
  143: $MEM = First-NonEmpty $C_MEM
  144: 
  145: # --- Exports CSV (avec fallback 0-ligne)
  146: if ($RPS) { $RPS.result | % { Summarize $_ } | Export-Csv -NoTypeInformation -Encoding UTF8 (Join-Path $OutRoot "rps.csv") } else { Write-ZeroCsv (Join-Path $OutRoot "rps.csv") }
  147: if ($P95) { $P95.result | % { Summarize $_ } | Export-Csv -NoTypeInformation -Encoding UTF8 (Join-Path $OutRoot "p95.csv") } else { Write-ZeroCsv (Join-Path $OutRoot "p95.csv") }
  148: if ($E5X) { $E5X.result | % { Summarize $_ } | Export-Csv -NoTypeInformation -Encoding UTF8 (Join-Path $OutRoot "5xx.csv") } else { Write-ZeroCsv (Join-Path $OutRoot "5xx.csv") }
  149: if ($CPU) { $CPU.result | % { Summarize $_ } | Export-Csv -NoTypeInformation -Encoding UTF8 (Join-Path $OutRoot "cpu.csv") }
  150: if ($MEM) { $MEM.result | % { Summarize $_ } | Export-Csv -NoTypeInformation -Encoding UTF8 (Join-Path $OutRoot "mem.csv") }
  151: 
  152: # --- résumé console
  153: $png = Get-ChildItem $ImgDir -Filter "panel_*.png" -ErrorAction SilentlyContinue
  154: $rpsN = (Import-Csv (Join-Path $OutRoot "rps.csv") -ErrorAction SilentlyContinue).Count
  155: $p95N = (Import-Csv (Join-Path $OutRoot "p95.csv") -ErrorAction SilentlyContinue).Count
  156: $e5xN = (Import-Csv (Join-Path $OutRoot "5xx.csv") -ErrorAction SilentlyContinue).Count
  157: W "PNG count = $($png.Count)"
  158: W "Rows rps=$rpsN p95=$p95N 5xx=$e5xN"
  159: W "Expr RPS = $($RPS.expr)"
  160: W "Expr P95 = $($P95.expr)"
  161: W "Expr 5XX = $($E5X.expr)"
  162: 
  163: Write-Host "=== AUDIT RENDER ==="
  164: Write-Host "PNG: $($png.Count) fichiers"
  165: Write-Host "CSV: rps=$rpsN, p95=$p95N, 5xx=$e5xN (cpu/mem aussi écrits)"
  166: Write-Host "Diag: $Diag"
  167: 

----- [020] scripts\gen_traffic.ps1 -----
    1: # gen_traffic.ps1
    2: param(
    3:   [string]$Ns="default",
    4:   [string]$OkUrl="http://doctrine-demo-svc.default.svc.cluster.local/healthz"
    5: )
    6: 
    7: $ErrorActionPreference="Stop"
    8: 
    9: # Nettoyage des pods de charge
   10: kubectl -n $Ns delete pod fortio-ok fortio-err --ignore-not-found --wait=false | Out-Null
   11: 
   12: # Trafic OK (remplit RPS et p95 si histogrammes exposés)
   13: kubectl -n $Ns run fortio-ok --image=fortio/fortio --restart=Never --command -- `
   14:   fortio load -qps 40 -t 2m -c 4 $OkUrl
   15: 
   16: # Déploie un producteur de 500 (httpbin) si pas déjà présent
   17: @"
   18: apiVersion: apps/v1
   19: kind: Deployment
   20: metadata: { name: demo-500, namespace: $Ns, labels: { app: demo-500 } }
   21: spec:
   22:   replicas: 1
   23:   selector: { matchLabels: { app: demo-500 } }
   24:   template:
   25:     metadata: { labels: { app: demo-500 } }
   26:     spec:
   27:       containers:
   28:       - name: httpbin
   29:         image: kennethreitz/httpbin
   30:         ports: [{ containerPort: 80, name: http }]
   31: ---
   32: apiVersion: v1
   33: kind: Service
   34: metadata: { name: demo-500, namespace: $Ns }
   35: spec:
   36:   selector: { app: demo-500 }
   37:   ports: [{ port: 80, targetPort: 80, name: http }]
   38: "@ | kubectl apply -f - | Out-Null
   39: 
   40: # Trafic 5xx synthétique 45s
   41: kubectl -n $Ns run fortio-err --image=fortio/fortio --restart=Never --command -- `
   42:   sh -lc "fortio load -qps 5 -t 45s -c 2 http://demo-500.$Ns.svc.cluster.local/status/500"

----- [021] scripts\pf_keepalive.ps1 -----
    1: # pf_keepalive.ps1
    2: param(
    3:   [string]$Ns = "monitoring",
    4:   [int]$GF = 3000, [int]$PM = 9090, [int]$AM = 9093
    5: )
    6: $ErrorActionPreference = "Stop"
    7: 
    8: function Kill-OldPF {
    9:   Get-CimInstance win32_process -Filter "name='kubectl.exe' AND commandline LIKE '%port-forward%'" |
   10:     Invoke-CimMethod -MethodName Terminate | Out-Null
   11: }
   12: 
   13: function Wait-HTTP($url, $sec=12) {
   14:   $deadline = (Get-Date).AddSeconds($sec)
   15:   do {
   16:     try { Invoke-WebRequest $url -UseBasicParsing -TimeoutSec 4 | Out-Null; return $true }
   17:     catch { Start-Sleep 1 }
   18:   } until ((Get-Date) -gt $deadline)
   19:   return $false
   20: }
   21: 
   22: function Ensure-PF($name, $svc, $portPair, $healthUrl) {
   23:   if (Wait-HTTP $healthUrl) { Write-Host "PF $name déjà OK" -f Green; return }
   24:   Start-Process -WindowStyle Hidden powershell -ArgumentList "kubectl -n $Ns port-forward svc/$svc $portPair" | Out-Null
   25:   Start-Sleep 2
   26:   if (!(Wait-HTTP $healthUrl)) {
   27:     # fallback: port-forward sur le POD directement
   28:     $pod = (kubectl -n $Ns get pod -l "app.kubernetes.io/name=$name" -o jsonpath="{.items[0].metadata.name}" 2>$null)
   29:     if ($pod) {
   30:       Start-Process -WindowStyle Hidden powershell -ArgumentList "kubectl -n $Ns port-forward pod/$pod $portPair" | Out-Null
   31:       Start-Sleep 2
   32:     }
   33:   }
   34:   if (Wait-HTTP $healthUrl) { Write-Host "PF $name OK ($svc → $portPair)" -f Green }
   35:   else { throw "PF $name KO ($healthUrl)" }
   36: }
   37: 
   38: Kill-OldPF
   39: Ensure-PF "grafana"     "kpstack-grafana"                          "$GF:80"    "http://localhost:$GF/api/health"
   40: Ensure-PF "prometheus"  "kpstack-kube-prometheus-st-prometheus"    "$PM:9090"  "http://localhost:$PM/-/healthy"
   41: Ensure-PF "alertmanager" "kpstack-kube-prometheus-st-alertmanager" "$AM:9093"  "http://localhost:$AM/-/healthy"

===== Heuristiques d’articulation (images, ports, hosts, rules, queries) =====
Images Docker référencées (image: …):
k8s\deployment.yaml:26:           image: ghcr.io/ORG/doctrine-demo:latest
Ports (containerPort/port/targetPort/EXPOSE):
app\Dockerfile:15: EXPOSE 8080
k8s\deployment.yaml:28:           ports: [{ containerPort: 8080 }]
k8s\ingress.yaml:20:                 port:
k8s\monitoring-fix.yaml:13:       port: 80
k8s\monitoring-fix.yaml:14:       targetPort: 8080 # ← ton container expose 8080
k8s\service.yaml:11:       port: 80
k8s\service.yaml:12:       targetPort: 8080
monitoring\grafana-ingress.yaml:20:             port:
monitoring\podmonitor-app.yaml:14:     - targetPort: 8080
Dockerfile:26: EXPOSE 8080
Ingress hosts:
Prometheus rules / expr:
monitoring\prometheus.rules.yml:5:     expr: histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket{route="/search"}[2m])) by (le))
monitoring\prometheusrule.yaml:12:       expr: histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket{route="/search"}[2m])) by (le)) > 0.3
PromQL candidates in audit_full_fix.ps1:
scripts\audit_full_fix.ps1:120: $C_RPS = @(
scripts\audit_full_fix.ps1:126: $C_P95 = @(
scripts\audit_full_fix.ps1:131: $C_5XX = @(
scripts\audit_full_fix.ps1:136: $C_CPU = @('sum by (pod) (rate(container_cpu_usage_seconds_total{pod=~"doctrine-demo.*"}[5m]))')
scripts\audit_full_fix.ps1:137: $C_MEM = @('max by (pod) (container_memory_working_set_bytes{pod=~"doctrine-demo.*"})')
scripts\audit_png_csv.ps1:113: $C_RPS = @(
scripts\audit_png_csv.ps1:118: $C_P95 = @(
scripts\audit_png_csv.ps1:122: $C_5XX = @(
scripts\audit_png_csv.ps1:126: $C_CPU = @('sum by (pod) (rate(container_cpu_usage_seconds_total{pod=~"doctrine-demo.*"}[5m]))')
scripts\audit_png_csv.ps1:127: $C_MEM = @('max by (pod) (container_memory_working_set_bytes{pod=~"doctrine-demo.*"})')

===== Fin de l'audit =====
OK ✅  — Audit écrit dans : C:\ATLAS\INBOX\dev\devops\platform_lite\doctrine-demo-platform-lite\audit\app\repo_audit_20251019_130056.txt
